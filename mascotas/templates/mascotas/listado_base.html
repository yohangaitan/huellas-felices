{% extends 'mascotas/base.html' %}

{% block title %}Listado de Adopci贸n{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    
    {# T铆tulo de la Secci贸n #}
    <h1 class="mb-6 text-4xl font-extrabold text-gray-800 text-center">
        {% if view.kwargs.filter == 'Perro' %}
             Perros en Adopci贸n
        {% elif view.kwargs.filter == 'Gato' %}
             Gatos en Adopci贸n
        {% else %}
            Mascotas en Adopci贸n
        {% endif %}
    </h1>

    {# Secci贸n de Filtros y B煤squeda (Actualizada a Teal) #}
    <div class="mb-10 p-4 lg:p-6 bg-white border border-gray-200 rounded-xl shadow-lg">
        <h4 class="text-xl font-bold mb-4 text-gray-700">Filtrar y Buscar</h4>
        
        <form method="GET" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 items-end">
            
            {# Campo de B煤squeda #}
            <div class="lg:col-span-2">
                <input type="text" name="q" placeholder="Buscar por nombre o raza..." 
                        value="{{ query }}" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 shadow-sm">
            </div>

            {# Selects (Tama帽o, Edad, Provincia) - Actualizados a Teal #}
            <div>
                <select name="tamano" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500">
                    <option value="">Tama帽o</option>
                    {% for key, value in TAMANO_CHOICES %}
                        <option value="{{ key }}" {% if key == tamano_seleccionado %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <select name="edad" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500">
                    <option value="">Edad</option>
                    {% for key, value in EDAD_CHOICES %}
                        <option value="{{ key }}" {% if key == edad_seleccionada %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>

            {# CAMBIO 2: NUEVO: Filtro por Sexo (G茅nero) #}
            <div> 
                {# Nota: Usamos 'genero' como nombre para coincidir con tu campo en models.py #}
                <select name="genero" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500">
                    <option value="">Genero</option>
                    {% for key, value in SEXO_CHOICES %}
                        <option value="{{ key }}" {% if key == sexo_seleccionado %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>
            
            {# CAMBIO 2: NUEVO: Filtro por Color #}
            <div>
                <select name="color" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500">
                    <option value="">Color</option>
                    {% for key, value in COLOR_CHOICES %}
                        <option value="{{ key }}" {% if key == color_seleccionado %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <select name="region" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500">
                    <option value="">Provincia</option>
                    {% for key, value in REGION_CHOICES %}
                        <option value="{{ key }}" {% if key == region_seleccionada %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>
            
            {# Bot贸n Aplicar (Actualizado a Teal) #}
            <button type="submit" class="w-full px-6 py-2 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition shadow-md">
                <i class="bi bi-funnel mr-1"></i> Aplicar
            </button>
            
            {# Bot贸n Limpiar #}
            {% if query or tamano_seleccionado or edad_seleccionada or region_seleccionada %}
                <a href="." class="w-full px-6 py-2 bg-gray-400 text-white font-semibold rounded-lg hover:bg-gray-500 transition shadow-md text-center">
                    Limpiar
                </a>
            {% endif %}
        </form>
    </div>


    {# LISTADO DE MASCOTAS - Tarjetas con estilo Teal #}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
        
        {% for mascota in mascotas_disponibles %}
        
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden transform hover:scale-[1.03] transition duration-300 ease-in-out border border-gray-100 flex flex-col">
            
            {# Imagen #}
            <a href="{% url 'mascotas:detalle_mascota' pk=mascota.pk %}">
                <img src="{{ mascota.imagen.url }}" 
                    class="w-full h-56 object-cover object-center transition duration-500 hover:opacity-90" 
                    alt="Foto de {{ mascota.nombre }}">
            </a>
            
            {# Cuerpo de la Tarjeta #}
            <div class="p-4 flex flex-col flex-grow">
                
                {# T铆tulo/Nombre #}
                <h2 class="text-xl font-bold text-gray-900 mb-2 truncate">
                    <a href="{% url 'mascotas:detalle_mascota' pk=mascota.pk %}" class="hover:text-teal-600 transition"> {# Enlace hover Teal #}
                        {{ mascota.nombre }}
                    </a>
                </h2>
                
                {# Etiquetas (Especie y Tama帽o) #}
                <div class="flex flex-wrap gap-2 text-xs mb-3">
                    {# Especie (Teal) #}
                    <span class="px-2 py-1 rounded-full bg-teal-100 text-teal-800 font-medium">
                        {{ mascota.get_especie_display }}
                    </span>
                    {# Tama帽o (Gris) #}
                    <span class="px-2 py-1 rounded-full bg-gray-200 text-gray-700 font-medium">
                        {{ mascota.get_tamano_display }}
                    </span>
                </div>
                
                {# Detalles Adicionales #}
                <p class="text-sm text-gray-500 mb-4 flex-grow">
                    <span class="font-semibold">{{ mascota.raza }}</span> | {{ mascota.get_edad_display }}
                    <br>
                    <i class="bi bi-geo-alt-fill mr-1 text-teal-500"></i> {{ mascota.get_region_display }} {# cono de Ubicaci贸n Teal #}
                </p>
                
                {# Bot贸n de CTA (Actualizado a Teal) #}
                <a href="{% url 'mascotas:detalle_mascota' pk=mascota.pk %}" 
                   class="mt-auto w-full block text-center py-2 bg-teal-600 text-white font-bold rounded-lg hover:bg-teal-700 transition shadow-md">
                    隆Me Interesa!
                </a>
            </div>
        </div>
        
        {% empty %}
        <div class="col-span-full mt-5 text-center text-gray-500">
            <p class="text-xl font-semibold">No se encontraron mascotas que coincidan con tu b煤squeda.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}